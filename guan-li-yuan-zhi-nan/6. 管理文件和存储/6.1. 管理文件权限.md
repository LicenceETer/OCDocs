# 第 6 章 管理文件和存储

本章主要介绍了如何管理文件权限、配置分区及挂载文件系统。

## 6.1. 管理文件权限

### 6.1.1 文件权限简介

文件权限控制用户或组查看、修改、执行、访问文件或者目录的能力。

每个文件或者目录都有三种权限对象：

- `u` - 文件或目录所有者
- `g` - 文件或目录组所有者
- `o` - 其他

针对三种权限对象，都可分配以下权限：

- `r` - 读
- `w` - 写
- `x` - 执行
- `-` - 无权限

其中，文件的执行权限代表允许执行该文件，目录的执行权限代表允许切换至该目录。

要查看文件或目录的权限，可以通过`ls -l`命令进行查看：  
```
$ ls -l	
-rwxrw-r--  1 root root         50 May  5 16:14 test_file
drwxr-xr--  5 root root       4096 May 19 19:24 test_folder
```

其中，对于文件权限`-rw-r--r--  1 root root         50 May  5 16:14 test_file`

- `-` 表示它是文件。
- `rwx` 表示文件所有者有读、写和执行文件的权限。
- `rw-` 表示组有读写权限，但不能执行文件。
- `---` 表示其他用户只有读权限，但没有写或执行文件的权限。

对于目录权限`drwxr-xr--  5 root root       4096 May 19 19:24 test_folder`

- `d` 表示它是一个目录。
- `rwx` 表示目录所有者有读、写和访问目录内容的权限。
- `r-x` 表示组有读取权限、可以访问目录，但没有写的权限。
- `r--` 表示其他用户有读取权限，但没有写或者访问目录的权限。

#### 使用数字表示文件权限

为了便于配置，系统允许使用数字表示文件权限，其中数字代表的含义可以参考下表。

| **权限**     | **符号** | **数值** |
| ------------ | -------- | -------- |
| 读、写和执行 | rwx      | 7        |
| 读、写       | rw-      | 6        |
| 读和执行     | r-x      | 5        |
| 读           | r--      | 4        |
| 写和执行     | -wx      | 3        |
| 写           | -w-      | 2        |
| 执行         | --x      | 1        |
| 无权限       | ---      | 0        |

例如，对于前文显示的文件权限`-rwxrw-r--`，可以使用数字`764`表示。

### 6.1.2 基本权限与umask

在创建文件或目录时，系统会根据基本权限及umask两个因素分配新建文件或目录的默认权限。其中：  

- 目录的基本权限是 `777`（`drwxrwxrwxrwx`）
- 文件的基本权限是`666`（`-rw-rw-rw-`）
- 标准用户的默认 *umask* 是 `0002`
- `root` 用户的默认 *umask* 为 `0022`

umask由四位数字组成，第一位数字表示特殊权限，后三位数字表示从基本权限中减去的权限。 

例如，当umask为`0002`时，新建文件的权限将从文件基本权限`666`中对应减去`002`，即新建文件权限为`664`。或者，当umask为`0027`时，新建目录的权限将从目录基本权限`777`中减去`027`，即新建目录的权限为`750`。

### 6.1.3 修改文件权限及umask

- 要修改文件或目录的权限，可以通过`chmod`命令。例如，要将*test_file*的权限修改为755，可以使用以下命令：  
  ```
  $ chmod 755 test_file
  ```

- 要查看当前shell会话的umask，可以使用`umask`命令，该命令将以数字形式返回结果：  
  ```
  $ umask
  0022
  ```

- 要修改当前shell会话的umask，可以使用`umask`命令。例如，要将当前shell会话的umask设置为0020，可以使用以下命令： 
  ```
  $ umask 0020
  ```

- 要修改登录shell会话时的默认umask，可以在`/etc/profile`中对以下内容进行修改：  
  ```
  # By default, we want umask to get set. This sets it for login shell
  # Current threshold for system reserved uid/gids is 200
  # You could check uidgid reservation validity in
  # /usr/share/doc/setup-*/uidgid file
  if [ $UID -gt 199 ] && [ "`/usr/bin/id -gn`" = "`/usr/bin/id -un`" ]; then
      umask 002
  else
      umask 022
  fi
  ```

  



